<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <title>My profile</title>
    <link rel="stylesheet" type="text/css" href="/scripts/style.css" media="screen"/>
    <script src="/scripts/utils.js"></script>
    <script src="/scripts/POPUP.js"></script>
    <script src="/scripts/constants.js"></script>
    <script>
        let States = new Map([
            [0, "LeftTheLobby"],
            [1, "Error"],
            [2, "LobbyList"],
            [3, "ConnectedBlue"],
            [4, "ConnectedRed"],
            [5, "SpectatorConnectedBlue"],
            [6, "SpectatorConnectedRed"],
            [7, "SentChars"],
            [8, "Ready"],
            [9, "Not ready"],
            [10, "GameStart"],
            [11, "LeaderChange"],
            [12, "LobbyInfo"],
        ]);
        let ws;

        function add(what) {
            document.getElementById("lobby").innerText += what + "\n\n";
            document.getElementById("lobby").scrollTop = document.getElementById("lobby").scrollHeight;
        }

        function connectToServer(why) {
            if (ws) {
                return
            }
            let loc = window.location, new_uri;
            if (loc.protocol === "https:") {
                new_uri = "wss:";
            } else {
                new_uri = "ws:";
            }
            new_uri += "//" + loc.host + "/lobby";
            ws = new WebSocket(new_uri);

            ws.onopen = function (evt) {
                ws.send(JSON.stringify(why));
                add("[OPEN]");
            };
            ws.onclose = function (evt) {
                add("[CLOSE]");
                ws = null;
            };
            ws.onmessage = function (evt) {
                let battleresponse = JSON.parse(evt.data);
                add(States.get(battleresponse.Event) + ": " + battleresponse.Who);
                if (battleresponse.Event === 10) {
                    location = battleresponse.Who;
                }
            };
            ws.onerror = function (evt) {
                add("[ERROR]:" + evt);
            };
        }

        function send(what) {
            if (!ws) {
                connectToServer(what);
                return
            }
            ws.send(JSON.stringify(what));
        }
    </script>
</head>
<body>
<table WIDTH="100%">
    <tr>
        <td width="250px">
            <div align="center" id="username"></div>
        </td>
        <td class="centerc">
            <div align="center"><a href="/">My Profile</a></div>
        </td>
        <td class="centerc">
            <div align="center"><a href="/girllist">Choose chars</a></div>
        </td>
        <td class="centerc">
            <div align="center"><a href="/conversion">Conversion</a></div>
        </td>
        <td class="centerc">
            <div align="center"><a href="/shop">Shop</a></div>
        </td>
        <td class="centerc">
            <div align="center"><a href="/friends">Friend list</a></div>
        </td>
        <td class="rightc">
            <div align="right"><a href="/logout">Logout</a></div>
        </td>
    </tr>
</table>
<table border="0px" width="100%">
    <tr>
        <td width="250px" style="vertical-align: top">
            <table id="moneytable" style="width: 250px;" border="0px">
                <tr>
                    <td width="33%" class="middlec">
                        <img src="/images/locked/white_dust.png" style="width:40px;height:40px;"
                             alt="white dust"><br>
                        <div id="wDust">0
                        </div>
                    </td>
                    <td width="33%" class="middlec">
                        <img src="/images/locked/blue_dust.png" style="width:40px;height:40px;"
                             alt="blue dust"><br>
                        <div id="bDust">0
                        </div>
                    </td>
                    <td width="33%" class="middlec">
                        <img src="/images/locked/yellow_dust.png" style="width:40px;height:40px;"
                             alt="yellow dust"><br>
                        <div id="yDust">0
                        </div>
                    </td>
                </tr>
                <tr>
                    <td width="33%" class="middlec">
                        <img src="/images/locked/purple_dust.png" style="width:40px;height:40px;"
                             alt="purple dust"><br>
                        <div id="pDust">0
                        </div>
                    </td>
                    <td width="33%" class="middlec">
                        <img src="/images/locked/star_dust.png" style="width:40px;height:40px;"
                             alt="stardust"><br>
                        <div id="sDust">0
                        </div>
                    </td>
                </tr>
            </table>
        </td>
        <td>
        </td>
    </tr>
</table>
<div align="center">
<div id="lobby" style="max-height: 300px; overflow: auto;"></div>
<input type="text" maxlength="75" id="lobbychat" autofocus
       onkeypress="if (event.keyCode === 13) {let lc = document.getElementById('lobbychat');
                   send(lc.value);
                   lc.value = '';}"/></div>
<div align="right" id="popupWrapper" class="popupWrapper"></div>
</body>
</html>